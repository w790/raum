# Аудит безопасности - RAÚM Fashion Store

### Небезопасное управление сессиями и правами доступа
- **Расположение**: `apps/orders/views.py` и `apps/payments/views.py`
- **Проблема**: `order_id` берется из сессии, но нет жесткой проверки, что текущий `request.user` или текущий владелец сессии действительно является автором этого заказа в базе данных.
- **Риск**: Хотя сейчас нет URL с ID заказа (`/orders/1/`), при их добавлении любой пользователь сможет просматривать чужие заказы, просто подставив ID. Также заказ не "привязан" к конкретному сессионному ключу в модели Order.
- **Рекомендация**: При создании заказа записывать в БД `session_key` или `user_id`. Во всех вьюхах, работающих с заказом, проверять соответствие: `Order.objects.get(id=id, user=request.user)` или по `session_key`.

### Манипуляция ценами (Статичные цены в корзине)
- **Расположение**: `apps/cart/cart.py:CartService`
- **Проблема**: При добавлении товара в корзину цена (price) сохраняется в сессию как строка. Все расчеты итогов и создание заказа используют эту сохраненную цену.
- **Риск**: Если цена товара в базе данных изменится (подорожает) после того, как пользователь добавил его в корзину, он все равно сможет оформить заказ по старой (более низкой) цене из своей сессии.
- **Рекомендация**: В методах `__iter__`, `get_total_price` и при создании заказа (`OrderService`) необходимо всегда заново получать актуальные цены из базы данных по `product_id`, а не доверять данным из сессии.


### Отсутствие заголовков безопасности
- **Расположение**: `wShop/settings.py`
- **Проблема**: Отсутствуют стандартные настройки безопасности middleware Django.
- **Риск**: Повышенная уязвимость к атакам XSS, Clickjacking и понижению протокола (Protocol Downgrade).
- **Рекомендация**: Добавьте следующие настройки в `settings.py`:
    - `SECURE_SSL_REDIRECT = True` (в продакшене)
    - `SECURE_HSTS_SECONDS = 31536000`
    - `SECURE_BROWSER_XSS_FILTER = True`
    - `SECURE_CONTENT_TYPE_NOSNIFF = True`
    - `SESSION_COOKIE_SECURE = True`
    - `CSRF_COOKIE_SECURE = True`






